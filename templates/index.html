<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>KuSehat Web 3</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <style>
    body { font-family: sans-serif; margin: 20px; }
    nav a { margin-right: 15px; cursor: pointer; }
    section { display: none; }
    section.active { display: block; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    th { background-color: #f2f2f2; }
    video.hidden { display: none; }
    .diagnosis { margin-top: 15px; padding: 10px; border: 1px solid #eee; background-color: #f9f9f9; border-radius: 5px; }
  </style>
</head>
<body>

  <nav>
    <a onclick="showSection('pricing')">Pricing</a>
    <a onclick="showSection('login')">Login</a>
    <a onclick="showSection('register')">Daftar</a>
    <a onclick="showSection('dashboard')">Dashboard</a>
    <a onclick="showSection('topup')">Top Up</a>
    <a onclick="showSection('exchange')">Tukar Gambar</a>
    <a onclick="showSection('diseaseprice')">Harga Penukaran</a>

  </nav>

  <section id="pricing" class="active">
    <h2>Pricing List</h2>
    <table>
      <thead>
        <tr><th>Paket</th><th>Fitur</th><th>Harga</th></tr>
      </thead>
      <tbody>
        <tr><td>Basic</td><td>Fitur Deteksi Penyakit melalui kamera</td><td>IDR. 50.000</td></tr>
        <tr><td>Premium</td><td>1. Fitur Deteksi penyakit melalui kamera,2. Fitur Deteksi penyakit melalui upload gambar</td><td>IDR. 150.000</td></tr>
      </tbody>
    </table>
  </section>

  <section id="login">
    <h2>Login</h2>
    <form action="/login" method="post">
      <label>Email:</label><br>
      <input type="email" name="email" required><br><br>
      <label>Password:</label><br>
      <input type="password" name="password" required><br><br>
      <button type="submit">Login</button>
    </form>
  </section>

  <section id="register">
    <h2>Daftar Akun</h2>
    <form action="/register" method="post">
      <label>Nama:</label><br>
      <input type="text" name="nama" required><br><br>
      <label>Email:</label><br>
      <input type="email" name="email" required><br><br>
      <label>Password:</label><br>
      <input type="password" name="password" required><br><br>
      <button type="submit">Daftar</button>
    </form>
  </section>

  <section id="dashboard">
    <h2>Dashboard Pengguna</h2>
    <p>Saldo Anda: <strong>IDR. 1.000.000</strong></p>
    <hr>
    
    <div class="container">
        <h3>Deteksi Penyakit Kulit dengan AI</h3>

        <form method="POST" enctype="multipart/form-data" id="uploadForm">
            <p><strong>Pilih metode deteksi:</strong></p>
            
            <button type="button" onclick="aktifkanKamera()">ðŸ“· Aktifkan Kamera</button>
            <video id="kamera" width="300" autoplay class="hidden" style="display: block; margin-top: 10px;"></video>
            <br><br>
            
            <p>Atau unggah gambar:</p>
            <input type="file" name="image" id="gambarInput" accept="image/*" multiple>
            <input type="submit" name="method" value="upload">
            <p id="jumlahUpload">Upload ke-0 dari 3</p>
        </form>

        {% if diagnosis %}
            <hr>
            <h3>Hasil Diagnosa:</h3>
            <div class="diagnosis">
                {{ diagnosis|safe }}
            </div>
        {% endif %}

        {% if image_path %}
            <p><strong>Gambar yang Dideteksi:</strong></p>
            <img src="{{ url_for('static', filename=image_path.split('static/')[-1]) }}" alt="Hasil Gambar" style="max-width: 300px; margin-top: 10px;">
        {% endif %}
    </div>
    </section>

  <section id="topup">
    <h2>Top Up Saldo Crypto</h2>
    <form action="/topup" method="post">
      <label>Jumlah (IDR):</label><br>
      <input type="number" name="jumlah" required><br><br>
      <label>Pilih Metode Pembayaran:</label><br>
      <select name="metode" required>
        <option value="btc">Bitcoin (BTC)</option>
        <option value="eth">Ethereum (ETH)</option>
        <option value="usdt">USDT (TRC20)</option>
      </select><br><br>
      <button type="submit">Kirim</button>
    </form>
  </section>

<section id="exchange">
  <h2>Penukaran Data Gambar Penyakit</h2>
  <form action="/exchange" method="post" enctype="multipart/form-data">
    <label for="imageUpload">Upload Gambar Penyakit:</label><br>
    <input type="file" id="imageUpload" name="image" accept="image/*" required><br><br>

    <label for="tujuanTukar">Pilih Tujuan Penukaran:</label><br>
    <select id="tujuanTukar" name="tujuan" required>
      <option value="dokter">Untuk data medis Rumah Sakit</option>
      <option value="data_ai">Untuk Pelatihan Model AI</option>
    </select><br><br>

    <button type="submit">Tukar Sekarang</button>
  </form>
</section>

<section id="diseaseprice">
  <h2>List Disease Exchange Price</h2>
  <table>
    <thead>
      <tr>
        <th>Jenis Data</th>
        <th>Harga Tukar (Rp)</th>
        <th>Tujuan</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1. Gambar Penyakit Kulit Parah seperti Kanker Kulit dan Gambar Penyakit Kelamin Parah Seperti Raja Singa dan Kanker Payudara</td>
        <td>IDR. 100.000</td>
        <td>Data medis Rumah Sakit</td>
      </tr>
      <tr>
        <td>3. Gambar Penyakit Kelamin Parah Seperti Raja Singa dan Kanker Payudara</td>
        <td>IDR. 200.000</td>
        <td>Data medis penyakit dan Pelatihan Model Diagnosis AI</td>
      </tr>
    </tbody>
  </table>
</section>


  <script>
    function showSection(id) {
      document.querySelectorAll('section').forEach(sec => sec.classList.remove('active'));
      document.getElementById(id).classList.add('active');
    }

    function aktifkanKamera() {
      const video = document.getElementById("kamera");
      navigator.mediaDevices.getUserMedia({ video: true })
        .then(stream => {
          video.srcObject = stream;
          video.classList.remove("hidden");
        })
        .catch(err => alert("Kamera tidak bisa diakses."));
    }

    let uploadCount = 0;
    // Mengikat fungsi ke form dengan ID 'uploadForm'
    document.getElementById("uploadForm").onsubmit = function (e) {
      // Periksa apakah tombol upload yang ditekan, bukan tombol kamera
      if (document.activeElement.value !== 'upload') {
        return;
      }
      
      const files = document.getElementById("gambarInput").files;
      if (uploadCount + files.length > 3) {
        alert("Batas upload gambar hanya 3.");
        e.preventDefault(); // Mencegah form untuk submit
      } else {
        uploadCount += files.length;
        document.getElementById("jumlahUpload").textContent = `Upload ke-${uploadCount} dari 3`;
        // Tidak mencegah submit jika valid, biarkan form dikirim ke server.
        // Jika tidak ingin langsung submit, tambahkan alert seperti sebelumnya.
        // alert("Gambar berhasil disiapkan untuk di-upload.");
      }
    }
  </script>
</body>
</html>
